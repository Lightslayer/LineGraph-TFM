tfm.exec.disableAutoNewGame(true)local a,b,c,d,e,f;local g='0123456789abcdef'function num2hex(h)local i=''while h>0 do local j=math.fmod(h,16)i=string.sub(g,j+1,j+1)..i;h=math.floor(h/16)end;return string.upper(i==''and'0'or i)end;function c(k)local l=k[1]for m=1,#k do m=k[m]if m<l then l=m end end;return l end;function d(k)local n=k[1]for m=1,#k do m=k[m]if m>n then n=m end end;return n end;function e(k,o)local p={}for q,m in next,k do p[q]=o(m)end;return p end;function f(r,s,t)local u=table.insert;local p={}for v=r,s,t do u(p,v)end;return p end;local function w(y)return 400-y end;a={}a.__index=a;setmetatable(a,{__call=function(z,...)return z.new(...)end})function a.new(A,B,C,D)assert(#A==#B,"Expected same number of data for both axis")local self=setmetatable({},a)self.name=C;self:setData(A,B)self.col=D or math.random(0x000000,0xFFFFFF)return self end;function a:getName()return self.name end;function a:getDX()return self.dx end;function a:getDY()return self.dy end;function a:getColor()return self.col end;function a:getMinX()return self.minX end;function a:getMinY()return self.minY end;function a:getMaxX()return self.maxX end;function a:getMaxY()return self.maxY end;function a:getDataLength()return#self.dx end;function a:getLineWidth()return self.lWidth or 3 end;function a:setName(C)self.name=C end;function a:setData(A,B)self.dx=A;self.dy=B;self.minX=c(A)self.minY=c(B)self.maxX=d(A)self.maxY=d(B)end;function a:setColor(D)self.col=D end;function a:setLineWidth(E)self.lWidth=E end;b={}b.__index=b;b._joints=10000;setmetatable(b,{__call=function(z,...)return z.new(...)end})function b.init()tfm.exec.addPhysicObject(-1,0,0,{type=14,miceCollision=false,groundCollision=false})end;function b.new(F,x,y,E,G)local self=setmetatable({},b)self.id=F;self.x=x;self.y=y;self.w=E;self.h=G;self.showing=false;self.joints=b._joints;b._joints=b._joints+10000;self.series={}return self end;function b:getId()return self.id end;function b:getDimension()return{x=self.x,y=self.y,w=self.w,h=self.h}end;function b:getMinX()return self.minX end;function b:getMaxX()return self.maxX end;function b:getMinY()return self.minY end;function b:getMaxY()return self.maxY end;function b:getXRange()return self.xRange end;function b:getYRange()return self.yRange end;function b:getGraphColor()return{bgColor=self.bg or 0x324650,borderColor=self.border or 0x212F36}end;function b:getAlpha()return self.alpha or 0.5 end;function b:isShowing()return self.showing end;function b:getDataLength()local H=0;for I,i in next,self.series do H=H+i:getDataLength()end;return H end;function b:show()self:refresh()local J,K=math.floor,math.ceil;ui.addTextArea(10000+self.id,"",nil,self.x,self.y,self.w,self.h,self.bg,self.border,self:getAlpha(),true)ui.addTextArea(11000+self.id,"<b>["..J(self.minX)..", "..J(self.minY).."]</b>",nil,self.x-15,self.y+self.h+5,50,50,nil,nil,0,true)ui.addTextArea(12000+self.id,"<b>"..K(self.maxX).."</b>",nil,self.x+self.w+10,self.y+self.h+5,50,50,nil,nil,0,true)ui.addTextArea(13000+self.id,"<b>"..K(self.maxY).."</b>",nil,self.x-15,self.y-10,50,50,nil,nil,0,true)ui.addTextArea(14000+self.id,"<b>"..K((self.maxX+self.minX)/2).."</b>",nil,self.x+self.w/2,self.y+self.h+5,50,50,nil,nil,0,true)ui.addTextArea(15000+self.id,"<br><br><b>"..K((self.maxY+self.minY)/2).."</b>",nil,self.x-15,self.y+(self.h-self.y)/2,50,50,nil,nil,0,true)local L=self.joints;local M=self.w/self.xRange;local N=self.h/self.yRange;for F,O in next,self.series do for P=1,O:getDataLength(),1 do tfm.exec.addJoint(self.id+6+L,-1,-1,{type=0,point1=J(O:getDX()[P]*M+self.x-self.minX*M)..","..J(w(O:getDY()[P]*N)+self.y-w(self.h)+self.minY*N),point2=J((O:getDX()[P+1]or O:getDX()[P])*M+self.x-self.minX*M)..","..J(w((O:getDY()[P+1]or O:getDY()[P])*N)+self.y-w(self.h)+self.minY*N),damping=0.2,line=O:getLineWidth(),color=O:getColor(),alpha=1,foreground=true})L=L+1 end end;self.showing=true end;function b:setGraphColor(Q,R)self.bg=Q;self.border=R end;function b:setAlpha(S)self.alpha=S end;function b:addSeries(O)table.insert(self.series,O)self:refresh()end;function b:removeSeries(C)for v=1,#self.series do if self.series[v]:getName()==C then table.remove(self.series,v)break end end;self:refresh()end;function b:refresh()self.minX,self.minY,self.maxX,self.maxY=nil;for q,i in next,self.series do self.minX=math.min(i:getMinX(),self.minX or i:getMinX())self.minY=math.min(i:getMinY(),self.minY or i:getMinY())self.maxX=math.max(i:getMaxX(),self.maxX or i:getMaxX())self.maxY=math.max(i:getMaxY(),self.maxY or i:getMaxY())end;self.xRange=self.maxX-self.minX;self.yRange=self.maxY-self.minY end;function b:resize(E,G)self.w=E;self.h=G end;function b:move(x,y)self.x=x;self.y=y end;function b:hide()for F=10000,17000,1000 do ui.removeTextArea(F+self.id)end;for P=self.joints,self.joints+self:getDataLength()+5,1 do tfm.exec.removeJoint(P)end;self.showing=false end;function b:showLabels(T)if T or T==nil then local U=""for I,O in next,self.series do U=U.."<font color='#"..num2hex(O:getColor()).."'> â–‰<b> "..O:getName().."</b></font><br>"end;ui.addTextArea(16000+self.id,U,nil,self.x+self.w+15,self.y,80,18*#self.series,self:getGraphColor().bgColor,self:getGraphColor().borderColor,self:getAlpha(),true)else ui.removeTextArea(16000+self.id,nil)end end;function b:displayGrids(T)if T or T==nil then local V=self.h/5;for F,y in next,f(self.y+V,self.y+self.h-V,V)do tfm.exec.addJoint(self.id+F,-1,-1,{type=0,point1=self.x..","..y,point2=self.x+self.w..","..y,damping=0.2,line=1,alpha=1,foreground=true,color=0xFFFFFF})end;tfm.exec.addJoint(self.id+5,-1,-1,{type=0,point1=self.x+self.w/2 ..","..self.y,point2=self.x+self.w/2 ..","..self.y+self.h,damping=0.2,line=2,alpha=1,foreground=true,color=0xFFFFFF})tfm.exec.addJoint(self.id+6,-1,-1,{type=0,point1=self.x..","..self.y+self.h/2,point2=self.x+self.w..","..self.y+self.h/2,damping=0.2,line=2,alpha=1,foreground=true,color=0xFFFFFF})end end;b.init()x=f(-5,5,0.5)y=e(x,function(x)return 2*x*x end)chart=b(1,200,110,400,200)chart:addSeries(a(x,y,"y = 2x^2",0xCC89FF))chart:setGraphColor(0xFFFFFF,0xFFFFFF)chart:displayGrids()chart:show();Series=a;LineChart=b;getMin=c;getMax=d;map=e;range=f
